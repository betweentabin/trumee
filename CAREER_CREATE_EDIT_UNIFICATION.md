# 職務経歴書 作成/編集 画面様式の統一（実施記録）

このドキュメントは、作成 (`/career/create`) と編集 (`/career/edit/[id]`) 画面の様式差異を解消し、作成画面に統一した対応内容をまとめたものです。

## 概要
- 目的: 作成・編集のUI/UXの一貫性を確保し、ユーザー混乱を防止
- 方針: 編集画面を作成画面の様式・構成に合わせる（ステッパー、レイアウト、入力項目の見た目と並び）

## 対象URL
- 一般ルート
  - 作成: `/career/create`
  - 編集: `/career/edit/[id]`
- ユーザーID付きルート（usersスコープ）
  - 作成: `/users/[userId]/career/create`（新規追加）
  - 編集: `/users/[userId]/career/edit/[id]`（新規追加）

## 実施内容
- ステッパーの統一
  - 6ステップ構成に変更: 基本情報・学歴 → 職歴 → スキル・資格 → 自己PR → 職務要約 → 完了
  - クリックで任意ステップへ移動できるUIに変更（作成画面と同じ挙動）
- レイアウト/スタイルの統一
  - コンテナ幅を `max-w-4xl`、背景/余白/影を作成画面に合わせて調整
  - 見出し階層と入力コントロールのパディング/角丸を揃える
- 入力項目の差分是正
  - 基本情報に「学歴」を含め、見出しを「基本情報・学歴」に変更
  - 職歴の開始/終了入力を `type="month"` に変更（作成画面と一致）
  - 職歴に「実績（achievements）」の箇条書き入力を追加
  - 自己PR（Step 4）を追加（編集画面で欠けていたため）
  - スキル・資格（Step 3）の見た目と操作を統一
- ナビゲーションボタンの統一
  - 前へ/次へボタンの配色・サイズ・配置を作成画面準拠に変更
- ルーティング追加（users配下）
  - usersスコープでも作成/編集をそのまま利用できる再エクスポートページを追加

## 変更ファイル
- 編集画面（大幅更新）
  - `frontend/app/career/edit/[id]/page.tsx`
- users配下ルーティング（追加）
  - `frontend/app/users/[userId]/career/edit/[id]/page.tsx`
  - `frontend/app/users/[userId]/career/create/page.tsx`

## バックエンド/API影響
- 既存APIマッピングは維持。skillsはカンマ区切り文字列として送信、詳細なセクション（職歴/学歴/資格/言語など）は `extra_data` に格納。
- PDF関連（メール送信/ダウンロード）は作成画面と同一のペイロード構造を使用。

## 確認手順（QA）
1. `/career/create` と `/career/edit/{id}` のステッパーが同じ見た目・挙動になること。
2. 基本情報ステップに「学歴」が含まれ、見出しが「基本情報・学歴」になっていること。
3. 職歴で開始/終了が `month` 入力になり、「実績」を追加/編集できること。
4. 自己PRのステップが存在し、編集内容が保存されること。
5. スキル・資格の見た目とボタン文言が作成画面と揃っていること。
6. 完了ステップで同意チェック後にPDFメール送信/ダウンロードが機能すること。
7. ユーザーID付きルート
   - `/users/{userId}/career/create` と `/users/{userId}/career/edit/{id}` が表示・操作できること。

## 追加対応（2025-09-25）
- 編集画面に「下書き保存/削除（localStorage）」を実装
  - 1レジュメID1キー: `career_edit_draft_v1_{resumeId}`
  - 自動保存: `resumeData` と `currentStep` を監視して保存
  - 読み込み: 初回マウント時に下書きがあれば優先的に復元（API結果は上書きしない）
  - 削除: 下書き削除後はAPIから最新を再取得
  - 変更箇所: `frontend/app/career/edit/[id]/page.tsx`

## 既知の課題・今後の改善
- 完了ステップのUI/文言を作成画面にさらに近づけるか（完全一致の可否）
- 必須項目のバリデーション/エラーメッセージの統一
- クラス名（primary/secondaryなど）の定義整理（デザインシステム化）

## 備考
- usersスコープのルーティングを用意したため、`/users/{userId}` 付きURLからも同様の画面が利用できます。
- 既存の「プレビュー／印刷」「保存」ボタンは維持しています。
